mod first_pass;
mod second_pass;

use crate::Result;
pub use second_pass::{Token, TokenKind};

pub fn process(source: &str) -> Result<Vec<Token>> {
    let subtokens = first_pass::process(source);
    second_pass::process(subtokens)
}

#[cfg(test)]
mod test {
    use super::{first_pass, second_pass};
    use super::{Token, TokenKind};
    use crate::Result;
    use first_pass::{SubToken, SubTokenKind};

    use std::fs;
    use std::num::NonZeroU32;

    fn subtoken(kind: SubTokenKind, line: u32) -> SubToken {
        SubToken { kind, line }
    }

    fn token(kind: TokenKind, line: u32) -> Token {
        Token { kind, line }
    }

    #[test]
    fn every_token() -> Result<()> {
        let source = fs::read_to_string("programs/tokens.chef")?;

        let subtokens = first_pass::process(&source);
        let expected_subtokens = {
            use SubTokenKind::*;
            vec![
                subtoken(Word("Tokens"), 0),
                subtoken(FullStop, 0),
                subtoken(BlankLine, 1),
                subtoken(Word("Ingredients"), 2),
                subtoken(FullStop, 2),
                subtoken(NewLine, 2),
                subtoken(Word("1"), 3),
                subtoken(Word("g"), 3),
                subtoken(Word("sugar"), 3),
                subtoken(NewLine, 3),
                subtoken(Word("1"), 4),
                subtoken(Word("kg"), 4),
                subtoken(Word("sugar"), 4),
                subtoken(NewLine, 4),
                subtoken(Word("1"), 5),
                subtoken(Word("pinch"), 5),
                subtoken(Word("sugar"), 5),
                subtoken(NewLine, 5),
                subtoken(Word("2"), 6),
                subtoken(Word("pinches"), 6),
                subtoken(Word("sugar"), 6),
                subtoken(NewLine, 6),
                subtoken(Word("1"), 7),
                subtoken(Word("ml"), 7),
                subtoken(Word("water"), 7),
                subtoken(NewLine, 7),
                subtoken(Word("1"), 8),
                subtoken(Word("l"), 8),
                subtoken(Word("water"), 8),
                subtoken(NewLine, 8),
                subtoken(Word("1"), 9),
                subtoken(Word("dash"), 9),
                subtoken(Word("water"), 9),
                subtoken(NewLine, 9),
                subtoken(Word("2"), 10),
                subtoken(Word("dashes"), 10),
                subtoken(Word("water"), 10),
                subtoken(NewLine, 10),
                subtoken(Word("1"), 11),
                subtoken(Word("cup"), 11),
                subtoken(Word("soda"), 11),
                subtoken(NewLine, 11),
                subtoken(Word("2"), 12),
                subtoken(Word("cups"), 12),
                subtoken(Word("soda"), 12),
                subtoken(NewLine, 12),
                subtoken(Word("1"), 13),
                subtoken(Word("teaspoon"), 13),
                subtoken(Word("soda"), 13),
                subtoken(NewLine, 13),
                subtoken(Word("2"), 14),
                subtoken(Word("teaspoons"), 14),
                subtoken(Word("soda"), 14),
                subtoken(NewLine, 14),
                subtoken(Word("1"), 15),
                subtoken(Word("tablespoon"), 15),
                subtoken(Word("soda"), 15),
                subtoken(NewLine, 15),
                subtoken(Word("2"), 16),
                subtoken(Word("tablespoons"), 16),
                subtoken(Word("soda"), 16),
                subtoken(NewLine, 16),
                subtoken(Word("1"), 17),
                subtoken(Word("heaped"), 17),
                subtoken(Word("cup"), 17),
                subtoken(Word("flour"), 17),
                subtoken(NewLine, 17),
                subtoken(Word("1"), 18),
                subtoken(Word("level"), 18),
                subtoken(Word("cup"), 18),
                subtoken(Word("flour"), 18),
                subtoken(BlankLine, 19),
                subtoken(Word("Method"), 20),
                subtoken(FullStop, 20),
                subtoken(NewLine, 20),
                subtoken(Word("Take"), 21),
                subtoken(Word("sugar"), 21),
                subtoken(Word("from"), 21),
                subtoken(Word("refrigerator"), 21),
                subtoken(FullStop, 21),
                subtoken(NewLine, 21),
                subtoken(Word("Put"), 22),
                subtoken(Word("sugar"), 22),
                subtoken(Word("into"), 22),
                subtoken(Word("the"), 22),
                subtoken(Word("mixing"), 22),
                subtoken(Word("bowl"), 22),
                subtoken(FullStop, 22),
                subtoken(NewLine, 22),
                subtoken(Word("Put"), 23),
                subtoken(Word("sugar"), 23),
                subtoken(Word("into"), 23),
                subtoken(Word("the"), 23),
                subtoken(Word("2nd"), 23),
                subtoken(Word("mixing"), 23),
                subtoken(Word("bowl"), 23),
                subtoken(FullStop, 23),
                subtoken(NewLine, 23),
                subtoken(Word("Fold"), 24),
                subtoken(Word("sugar"), 24),
                subtoken(Word("into"), 24),
                subtoken(Word("the"), 24),
                subtoken(Word("mixing"), 24),
                subtoken(Word("bowl"), 24),
                subtoken(FullStop, 24),
                subtoken(NewLine, 24),
                subtoken(Word("Fold"), 25),
                subtoken(Word("sugar"), 25),
                subtoken(Word("into"), 25),
                subtoken(Word("the"), 25),
                subtoken(Word("3rd"), 25),
                subtoken(Word("mixing"), 25),
                subtoken(Word("bowl"), 25),
                subtoken(FullStop, 25),
                subtoken(NewLine, 25),
                subtoken(Word("Add"), 26),
                subtoken(Word("sugar"), 26),
                subtoken(FullStop, 26),
                subtoken(NewLine, 26),
                subtoken(Word("Add"), 27),
                subtoken(Word("sugar"), 27),
                subtoken(Word("into"), 27),
                subtoken(Word("the"), 27),
                subtoken(Word("mixing"), 27),
                subtoken(Word("bowl"), 27),
                subtoken(FullStop, 27),
                subtoken(NewLine, 27),
                subtoken(Word("Add"), 28),
                subtoken(Word("sugar"), 28),
                subtoken(Word("into"), 28),
                subtoken(Word("the"), 28),
                subtoken(Word("1st"), 28),
                subtoken(Word("mixing"), 28),
                subtoken(Word("bowl"), 28),
                subtoken(FullStop, 28),
                subtoken(NewLine, 28),
                subtoken(Word("Remove"), 29),
                subtoken(Word("sugar"), 29),
                subtoken(FullStop, 29),
                subtoken(NewLine, 29),
                subtoken(Word("Remove"), 30),
                subtoken(Word("sugar"), 30),
                subtoken(Word("from"), 30),
                subtoken(Word("the"), 30),
                subtoken(Word("mixing"), 30),
                subtoken(Word("bowl"), 30),
                subtoken(FullStop, 30),
                subtoken(NewLine, 30),
                subtoken(Word("Remove"), 31),
                subtoken(Word("sugar"), 31),
                subtoken(Word("from"), 31),
                subtoken(Word("the"), 31),
                subtoken(Word("4th"), 31),
                subtoken(Word("mixing"), 31),
                subtoken(Word("bowl"), 31),
                subtoken(FullStop, 31),
                subtoken(NewLine, 31),
                subtoken(Word("Combine"), 32),
                subtoken(Word("sugar"), 32),
                subtoken(FullStop, 32),
                subtoken(NewLine, 32),
                subtoken(Word("Combine"), 33),
                subtoken(Word("sugar"), 33),
                subtoken(Word("into"), 33),
                subtoken(Word("the"), 33),
                subtoken(Word("mixing"), 33),
                subtoken(Word("bowl"), 33),
                subtoken(FullStop, 33),
                subtoken(NewLine, 33),
                subtoken(Word("Divide"), 34),
                subtoken(Word("sugar"), 34),
                subtoken(FullStop, 34),
                subtoken(NewLine, 34),
                subtoken(Word("Divide"), 35),
                subtoken(Word("sugar"), 35),
                subtoken(Word("into"), 35),
                subtoken(Word("the"), 35),
                subtoken(Word("mixing"), 35),
                subtoken(Word("bowl"), 35),
                subtoken(FullStop, 35),
                subtoken(NewLine, 35),
                subtoken(Word("Add"), 36),
                subtoken(Word("dry"), 36),
                subtoken(Word("ingredients"), 36),
                subtoken(FullStop, 36),
                subtoken(NewLine, 36),
                subtoken(Word("Add"), 37),
                subtoken(Word("dry"), 37),
                subtoken(Word("ingredients"), 37),
                subtoken(Word("to"), 37),
                subtoken(Word("the"), 37),
                subtoken(Word("10th"), 37),
                subtoken(Word("mixing"), 37),
                subtoken(Word("bowl"), 37),
                subtoken(FullStop, 37),
                subtoken(NewLine, 37),
                subtoken(Word("Liquefy"), 38),
                subtoken(Word("sugar"), 38),
                subtoken(FullStop, 38),
                subtoken(NewLine, 38),
                subtoken(Word("Liquefy"), 39),
                subtoken(Word("contents"), 39),
                subtoken(Word("of"), 39),
                subtoken(Word("the"), 39),
                subtoken(Word("mixing"), 39),
                subtoken(Word("bowl"), 39),
                subtoken(FullStop, 39),
                subtoken(NewLine, 39),
                subtoken(Word("Stir"), 40),
                subtoken(Word("for"), 40),
                subtoken(Word("10"), 40),
                subtoken(Word("minutes"), 40),
                subtoken(FullStop, 40),
                subtoken(NewLine, 40),
                subtoken(Word("Stir"), 41),
                subtoken(Word("for"), 41),
                subtoken(Word("1"), 41),
                subtoken(Word("minute"), 41),
                subtoken(FullStop, 41),
                subtoken(NewLine, 41),
                subtoken(Word("Stir"), 42),
                subtoken(Word("the"), 42),
                subtoken(Word("mixing"), 42),
                subtoken(Word("bowl"), 42),
                subtoken(Word("for"), 42),
                subtoken(Word("2"), 42),
                subtoken(Word("minutes"), 42),
                subtoken(FullStop, 42),
                subtoken(NewLine, 42),
                subtoken(Word("Stir"), 43),
                subtoken(Word("sugar"), 43),
                subtoken(Word("into"), 43),
                subtoken(Word("the"), 43),
                subtoken(Word("mixing"), 43),
                subtoken(Word("bowl"), 43),
                subtoken(FullStop, 43),
                subtoken(NewLine, 43),
                subtoken(Word("Mix"), 44),
                subtoken(Word("well"), 44),
                subtoken(FullStop, 44),
                subtoken(NewLine, 44),
                subtoken(Word("Mix"), 45),
                subtoken(Word("the"), 45),
                subtoken(Word("mixing"), 45),
                subtoken(Word("bowl"), 45),
                subtoken(Word("well"), 45),
                subtoken(FullStop, 45),
                subtoken(NewLine, 45),
                subtoken(Word("Clean"), 46),
                subtoken(Word("the"), 46),
                subtoken(Word("mixing"), 46),
                subtoken(Word("bowl"), 46),
                subtoken(FullStop, 46),
                subtoken(NewLine, 46),
                subtoken(Word("Pour"), 47),
                subtoken(Word("contents"), 47),
                subtoken(Word("of"), 47),
                subtoken(Word("the"), 47),
                subtoken(Word("mixing"), 47),
                subtoken(Word("bowl"), 47),
                subtoken(Word("into"), 47),
                subtoken(Word("the"), 47),
                subtoken(Word("2nd"), 47),
                subtoken(Word("baking"), 47),
                subtoken(Word("dish"), 47),
                subtoken(FullStop, 47),
                subtoken(NewLine, 47),
                subtoken(Word("Pour"), 48),
                subtoken(Word("contents"), 48),
                subtoken(Word("of"), 48),
                subtoken(Word("the"), 48),
                subtoken(Word("1st"), 48),
                subtoken(Word("mixing"), 48),
                subtoken(Word("bowl"), 48),
                subtoken(Word("into"), 48),
                subtoken(Word("the"), 48),
                subtoken(Word("baking"), 48),
                subtoken(Word("dish"), 48),
                subtoken(FullStop, 48),
                subtoken(NewLine, 48),
                subtoken(Word("Pour"), 49),
                subtoken(Word("contents"), 49),
                subtoken(Word("of"), 49),
                subtoken(Word("the"), 49),
                subtoken(Word("10th"), 49),
                subtoken(Word("mixing"), 49),
                subtoken(Word("bowl"), 49),
                subtoken(Word("into"), 49),
                subtoken(Word("the"), 49),
                subtoken(Word("10th"), 49),
                subtoken(Word("baking"), 49),
                subtoken(Word("dish"), 49),
                subtoken(FullStop, 49),
                subtoken(NewLine, 49),
                subtoken(Word("Loop"), 50),
                subtoken(Word("the"), 50),
                subtoken(Word("sugar"), 50),
                subtoken(FullStop, 50),
                subtoken(NewLine, 50),
                subtoken(Word("Set"), 51),
                subtoken(Word("aside"), 51),
                subtoken(FullStop, 51),
                subtoken(NewLine, 51),
                subtoken(Word("Keep"), 52),
                subtoken(Word("looping"), 52),
                subtoken(Word("the"), 52),
                subtoken(Word("sugar"), 52),
                subtoken(Word("until"), 52),
                subtoken(Word("looped"), 52),
                subtoken(FullStop, 52),
                subtoken(NewLine, 52),
                subtoken(Word("Serve"), 53),
                subtoken(Word("with"), 53),
                subtoken(Word("tokens"), 53),
                subtoken(FullStop, 53),
                subtoken(NewLine, 53),
                subtoken(Word("Refrigerate"), 54),
                subtoken(FullStop, 54),
                subtoken(NewLine, 54),
                subtoken(Word("Refrigerate"), 55),
                subtoken(Word("for"), 55),
                subtoken(Word("2"), 55),
                subtoken(Word("hours"), 55),
                subtoken(FullStop, 55),
                subtoken(NewLine, 55),
                subtoken(Word("Refrigerate"), 56),
                subtoken(Word("for"), 56),
                subtoken(Word("1"), 56),
                subtoken(Word("hour"), 56),
                subtoken(FullStop, 56),
                subtoken(BlankLine, 57),
                subtoken(Word("Serves"), 58),
                subtoken(Word("56"), 58),
                subtoken(FullStop, 58),
                subtoken(BlankLine, 59),
                subtoken(Word("Tokens"), 60),
                subtoken(Word("2"), 60),
                subtoken(FullStop, 60),
                subtoken(BlankLine, 61),
                subtoken(Word("Ingredients"), 62),
                subtoken(FullStop, 62),
                subtoken(NewLine, 62),
                subtoken(Word("1"), 63),
                subtoken(Word("egg"), 63),
                subtoken(BlankLine, 64),
                subtoken(Word("Method"), 65),
                subtoken(FullStop, 65),
                subtoken(NewLine, 65),
                subtoken(Word("Clean"), 66),
                subtoken(Word("the"), 66),
                subtoken(Word("mixing"), 66),
                subtoken(Word("bowl"), 66),
                subtoken(FullStop, 66),
                subtoken(NewLine, 66),
                subtoken(Word("Put"), 67),
                subtoken(Word("egg"), 67),
                subtoken(Word("into"), 67),
                subtoken(Word("the"), 67),
                subtoken(Word("mixing"), 67),
                subtoken(Word("bowl"), 67),
                subtoken(FullStop, 67),
                subtoken(NewLine, 67),
                subtoken(Word("Refrigerate"), 68),
                subtoken(Word("for"), 68),
                subtoken(Word("10"), 68),
                subtoken(Word("hours"), 68),
                subtoken(FullStop, 68),
                subtoken(BlankLine, 69),
                subtoken(Word("Serves"), 70),
                subtoken(Word("10"), 70),
                subtoken(FullStop, 70),
                subtoken(Eof, 70),
            ]
        };
        assert_eq!(subtokens, expected_subtokens);

        let tokens = second_pass::process(subtokens)?;
        let expected_tokens = {
            use TokenKind::*;
            vec![
                token(Identifier("Tokens".into()), 0),
                token(FullStop, 0),
                token(BlankLine, 1),
                token(Ingredients, 2),
                token(FullStop, 2),
                token(NewLine, 2),
                token(Number(1.into()), 3),
                token(DryMeasure, 3),
                token(Identifier("sugar".into()), 3),
                token(NewLine, 3),
                token(Number(1.into()), 4),
                token(DryMeasure, 4),
                token(Identifier("sugar".into()), 4),
                token(NewLine, 4),
                token(Number(1.into()), 5),
                token(DryMeasure, 5),
                token(Identifier("sugar".into()), 5),
                token(NewLine, 5),
                token(Number(2.into()), 6),
                token(DryMeasure, 6),
                token(Identifier("sugar".into()), 6),
                token(NewLine, 6),
                token(Number(1.into()), 7),
                token(LiquidMeasure, 7),
                token(Identifier("water".into()), 7),
                token(NewLine, 7),
                token(Number(1.into()), 8),
                token(LiquidMeasure, 8),
                token(Identifier("water".into()), 8),
                token(NewLine, 8),
                token(Number(1.into()), 9),
                token(LiquidMeasure, 9),
                token(Identifier("water".into()), 9),
                token(NewLine, 9),
                token(Number(2.into()), 10),
                token(LiquidMeasure, 10),
                token(Identifier("water".into()), 10),
                token(NewLine, 10),
                token(Number(1.into()), 11),
                token(AmbiguousMeasure, 11),
                token(Identifier("soda".into()), 11),
                token(NewLine, 11),
                token(Number(2.into()), 12),
                token(AmbiguousMeasure, 12),
                token(Identifier("soda".into()), 12),
                token(NewLine, 12),
                token(Number(1.into()), 13),
                token(AmbiguousMeasure, 13),
                token(Identifier("soda".into()), 13),
                token(NewLine, 13),
                token(Number(2.into()), 14),
                token(AmbiguousMeasure, 14),
                token(Identifier("soda".into()), 14),
                token(NewLine, 14),
                token(Number(1.into()), 15),
                token(AmbiguousMeasure, 15),
                token(Identifier("soda".into()), 15),
                token(NewLine, 15),
                token(Number(2.into()), 16),
                token(AmbiguousMeasure, 16),
                token(Identifier("soda".into()), 16),
                token(NewLine, 16),
                token(Number(1.into()), 17),
                token(MeasureType, 17),
                token(AmbiguousMeasure, 17),
                token(Identifier("flour".into()), 17),
                token(NewLine, 17),
                token(Number(1.into()), 18),
                token(MeasureType, 18),
                token(AmbiguousMeasure, 18),
                token(Identifier("flour".into()), 18),
                token(BlankLine, 19),
                token(Method, 20),
                token(FullStop, 20),
                token(NewLine, 20),
                token(Take, 21),
                token(Identifier("sugar".into()), 21),
                token(From, 21),
                token(Refrigerator, 21),
                token(FullStop, 21),
                token(NewLine, 21),
                token(Put, 22),
                token(Identifier("sugar".into()), 22),
                token(Into, 22),
                token(The, 22),
                token(MixingBowl, 22),
                token(FullStop, 22),
                token(NewLine, 22),
                token(Put, 23),
                token(Identifier("sugar".into()), 23),
                token(Into, 23),
                token(The, 23),
                token(Ordinal(NonZeroU32::new(2).unwrap()), 23),
                token(MixingBowl, 23),
                token(FullStop, 23),
                token(NewLine, 23),
                token(Fold, 24),
                token(Identifier("sugar".into()), 24),
                token(Into, 24),
                token(The, 24),
                token(MixingBowl, 24),
                token(FullStop, 24),
                token(NewLine, 24),
                token(Fold, 25),
                token(Identifier("sugar".into()), 25),
                token(Into, 25),
                token(The, 25),
                token(Ordinal(NonZeroU32::new(3).unwrap()), 25),
                token(MixingBowl, 25),
                token(FullStop, 25),
                token(NewLine, 25),
                token(Add, 26),
                token(Identifier("sugar".into()), 26),
                token(FullStop, 26),
                token(NewLine, 26),
                token(Add, 27),
                token(Identifier("sugar".into()), 27),
                token(Into, 27),
                token(The, 27),
                token(MixingBowl, 27),
                token(FullStop, 27),
                token(NewLine, 27),
                token(Add, 28),
                token(Identifier("sugar".into()), 28),
                token(Into, 28),
                token(The, 28),
                token(Ordinal(NonZeroU32::new(1).unwrap()), 28),
                token(MixingBowl, 28),
                token(FullStop, 28),
                token(NewLine, 28),
                token(Remove, 29),
                token(Identifier("sugar".into()), 29),
                token(FullStop, 29),
                token(NewLine, 29),
                token(Remove, 30),
                token(Identifier("sugar".into()), 30),
                token(From, 30),
                token(The, 30),
                token(MixingBowl, 30),
                token(FullStop, 30),
                token(NewLine, 30),
                token(Remove, 31),
                token(Identifier("sugar".into()), 31),
                token(From, 31),
                token(The, 31),
                token(Ordinal(NonZeroU32::new(4).unwrap()), 31),
                token(MixingBowl, 31),
                token(FullStop, 31),
                token(NewLine, 31),
                token(Combine, 32),
                token(Identifier("sugar".into()), 32),
                token(FullStop, 32),
                token(NewLine, 32),
                token(Combine, 33),
                token(Identifier("sugar".into()), 33),
                token(Into, 33),
                token(The, 33),
                token(MixingBowl, 33),
                token(FullStop, 33),
                token(NewLine, 33),
                token(Divide, 34),
                token(Identifier("sugar".into()), 34),
                token(FullStop, 34),
                token(NewLine, 34),
                token(Divide, 35),
                token(Identifier("sugar".into()), 35),
                token(Into, 35),
                token(The, 35),
                token(MixingBowl, 35),
                token(FullStop, 35),
                token(NewLine, 35),
                token(Add, 36),
                token(DryIngredients, 36),
                token(FullStop, 36),
                token(NewLine, 36),
                token(Add, 37),
                token(DryIngredients, 37),
                Token { kind: To, line: 37 },
                token(The, 37),
                token(Ordinal(NonZeroU32::new(10).unwrap()), 37),
                token(MixingBowl, 37),
                token(FullStop, 37),
                token(NewLine, 37),
                token(Liquefy, 38),
                token(Identifier("sugar".into()), 38),
                token(FullStop, 38),
                token(NewLine, 38),
                token(Liquefy, 39),
                token(ContentsOf, 39),
                token(The, 39),
                token(MixingBowl, 39),
                token(FullStop, 39),
                token(NewLine, 39),
                token(Stir, 40),
                token(For, 40),
                token(Number(10.into()), 40),
                token(Minutes, 40),
                token(FullStop, 40),
                token(NewLine, 40),
                token(Stir, 41),
                token(For, 41),
                token(Number(1.into()), 41),
                token(Minutes, 41),
                token(FullStop, 41),
                token(NewLine, 41),
                token(Stir, 42),
                token(The, 42),
                token(MixingBowl, 42),
                token(For, 42),
                token(Number(2.into()), 42),
                token(Minutes, 42),
                token(FullStop, 42),
                token(NewLine, 42),
                token(Stir, 43),
                token(Identifier("sugar".into()), 43),
                token(Into, 43),
                token(The, 43),
                token(MixingBowl, 43),
                token(FullStop, 43),
                token(NewLine, 43),
                token(Mix, 44),
                token(Well, 44),
                token(FullStop, 44),
                token(NewLine, 44),
                token(Mix, 45),
                token(The, 45),
                token(MixingBowl, 45),
                token(Well, 45),
                token(FullStop, 45),
                token(NewLine, 45),
                token(Clean, 46),
                token(The, 46),
                token(MixingBowl, 46),
                token(FullStop, 46),
                token(NewLine, 46),
                token(Pour, 47),
                token(ContentsOf, 47),
                token(The, 47),
                token(MixingBowl, 47),
                token(Into, 47),
                token(The, 47),
                token(Ordinal(NonZeroU32::new(2).unwrap()), 47),
                token(BakingDish, 47),
                token(FullStop, 47),
                token(NewLine, 47),
                token(Pour, 48),
                token(ContentsOf, 48),
                token(The, 48),
                token(Ordinal(NonZeroU32::new(1).unwrap()), 48),
                token(MixingBowl, 48),
                token(Into, 48),
                token(The, 48),
                token(BakingDish, 48),
                token(FullStop, 48),
                token(NewLine, 48),
                token(Pour, 49),
                token(ContentsOf, 49),
                token(The, 49),
                token(Ordinal(NonZeroU32::new(10).unwrap()), 49),
                token(MixingBowl, 49),
                token(Into, 49),
                token(The, 49),
                token(Ordinal(NonZeroU32::new(10).unwrap()), 49),
                token(BakingDish, 49),
                token(FullStop, 49),
                token(NewLine, 49),
                token(Identifier("Loop".into()), 50),
                token(The, 50),
                token(Identifier("sugar".into()), 50),
                token(FullStop, 50),
                token(NewLine, 50),
                token(SetAside, 51),
                token(FullStop, 51),
                token(NewLine, 51),
                token(Identifier("Keep looping".into()), 52),
                token(The, 52),
                token(Identifier("sugar".into()), 52),
                token(Until, 52),
                token(Identifier("looped".into()), 52),
                token(FullStop, 52),
                token(NewLine, 52),
                token(ServeWith, 53),
                token(Identifier("tokens".into()), 53),
                token(FullStop, 53),
                token(NewLine, 53),
                token(Refrigerate, 54),
                token(FullStop, 54),
                token(NewLine, 54),
                token(Refrigerate, 55),
                token(For, 55),
                token(Number(2.into()), 55),
                token(Hours, 55),
                token(FullStop, 55),
                token(NewLine, 55),
                token(Refrigerate, 56),
                token(For, 56),
                token(Number(1.into()), 56),
                token(Hours, 56),
                token(FullStop, 56),
                token(BlankLine, 57),
                token(Serves, 58),
                token(Number(56.into()), 58),
                token(FullStop, 58),
                token(BlankLine, 59),
                token(Identifier("Tokens 2".into()), 60),
                token(FullStop, 60),
                token(BlankLine, 61),
                token(Ingredients, 62),
                token(FullStop, 62),
                token(NewLine, 62),
                token(Number(1.into()), 63),
                token(Identifier("egg".into()), 63),
                token(BlankLine, 64),
                token(Method, 65),
                token(FullStop, 65),
                token(NewLine, 65),
                token(Clean, 66),
                token(The, 66),
                token(MixingBowl, 66),
                token(FullStop, 66),
                token(NewLine, 66),
                token(Put, 67),
                token(Identifier("egg".into()), 67),
                token(Into, 67),
                token(The, 67),
                token(MixingBowl, 67),
                token(FullStop, 67),
                token(NewLine, 67),
                token(Refrigerate, 68),
                token(For, 68),
                token(Number(10.into()), 68),
                token(Hours, 68),
                token(FullStop, 68),
                token(BlankLine, 69),
                token(Serves, 70),
                token(Number(10.into()), 70),
                token(FullStop, 70),
                token(Eof, 70),
            ]
        };

        assert_eq!(tokens, expected_tokens);
        Ok(())
    }
}
